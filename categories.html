<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Donations Dashboard - Categories</title>
  <meta name="description" content="Manage categories and sub-categories used across campaigns." />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#15C5CE" />

  <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon" />
  <link rel="preload" href="assets/fonts/Jost-Regular.ttf" as="font" type="font/ttf" crossorigin />

  <link rel="stylesheet" href="assets/css/normalize.css" />
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css" />
  <link rel="stylesheet" href="assets/css/all.min.css" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body data-theme="light">
  <a class="skip-link" href="#main-content">Skip to main content</a>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" aria-label="Primary navigation">
      <div class="sidebar__logo">
        <a class="sidebar__brand" href="index.html" aria-label="Donations dashboard home">
          <img src="assets/img/logo.svg" alt="Donations Dashboard logo" height="50" />
        </a>
      </div>

      <nav class="sidebar__nav" aria-label="Primary">
        <a class="sidebar__link" href="index.html">
          <i class="fas fa-th-large sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Overview</span>
        </a>

        <a class="sidebar__link" href="campaigns.html">
          <i class="fas fa-bullhorn sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Campaigns</span>
        </a>

        <a class="sidebar__link" href="donations.html">
          <i class="fas fa-hand-holding-heart sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Donations</span>
        </a>

        <a class="sidebar__link" href="donors.html">
          <i class="fas fa-users sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Donors</span>
        </a>

        <a class="sidebar__link" href="manual-donation.html">
          <i class="fas fa-keyboard sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Manual donations</span>
        </a>

        <a class="sidebar__link" href="messages.html">
          <i class="fas fa-envelope sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Messages</span>
        </a>

        <a class="sidebar__link" href="settings.html">
          <i class="fas fa-cog sidebar__icon" aria-hidden="true"></i>
          <span class="sidebar__label">Settings</span>
        </a>

        <!-- More submenu -->
        <li class="sidebar-item sidebar-item--expandable">
          <button class="sidebar-link sidebar-link--toggle" type="button" data-submenu="more-menu"
            aria-controls="more-menu" aria-expanded="false">
            <span class="d-flex align-items-center" style="gap: var(--space-3);">
              <i class="fa-solid fa-layer-group sidebar__icon" aria-hidden="true"></i>
              <span class="sidebar__label">More</span>
            </span>
            <i class="fa-solid fa-chevron-right submenu-caret" aria-hidden="true"></i>
          </button>

          <ul class="sidebar-submenu" id="more-menu" aria-hidden="true">
            <li>
              <a href="team.html" class="sidebar-sublink">
                <i class="fa-solid fa-user-shield" aria-hidden="true"></i>
                <span>Team &amp; roles</span>
              </a>
            </li>
            <li>
              <a href="exports.html" class="sidebar-sublink">
                <i class="fa-solid fa-file-export" aria-hidden="true"></i>
                <span>Exports &amp; reports</span>
              </a>
            </li>
            <li>
              <a href="integrations.html" class="sidebar-sublink">
                <i class="fa-solid fa-plug" aria-hidden="true"></i>
                <span>Integrations</span>
              </a>
            </li>
            <li>
              <a href="access-audit.html" class="sidebar-sublink">
                <i class="fa-solid fa-clipboard-list" aria-hidden="true"></i>
                <span>Access audit</span>
              </a>
            </li>
            <!-- Optional: put Categories here if you want -->
            <li>
              <a href="categories.html" class="sidebar-sublink is-active">
                <i class="fa-solid fa-tags" aria-hidden="true"></i>
                <span>Categories</span>
              </a>
            </li>
          </ul>
        </li>
      </nav>
    </aside>

    <div class="sidebar-overlay js-sidebar-overlay" aria-hidden="true"></div>

    <div class="app-main">
      <!-- Header -->
      <header class="app-header" aria-label="Dashboard header">
        <div class="app-header__left">
          <button class="icon-button js-sidebar-toggle" type="button" aria-label="Toggle sidebar"
            aria-controls="sidebar" aria-expanded="false">
            <i class="fas fa-bars" aria-hidden="true"></i>
          </button>
          <div class="app-header__titles">
            <p class="eyebrow">Dashboard</p>
            <h2 class="h4">Categories</h2>
          </div>
        </div>

        <div class="app-header__center">
          <form class="search" role="search" aria-label="Search dashboard">
            <label class="sr-only" for="dashboard-search">Search dashboard</label>
            <i class="fas fa-search" aria-hidden="true"></i>
            <input id="dashboard-search" type="search" name="q" placeholder="Search donors, campaigns, or messages"
              autocomplete="off" />
          </form>
        </div>

        <div class="app-header__right">
          <button class="icon-button js-theme-toggle" type="button" aria-label="Toggle theme">
            <i class="fas fa-sun" aria-hidden="true"></i>
          </button>

          <div class="dropdown-group">
            <button class="icon-button js-dropdown-toggle js-notifications-toggle" id="notifications-toggle"
              data-dropdown-target="notifications" type="button" aria-haspopup="true" aria-expanded="false"
              aria-controls="notifications-menu" aria-label="Open notifications">
              <span class="badge-dot"></span>
              <i class="fa fa-bell" aria-hidden="true"></i>
            </button>

            <div class="dropdown dropdown-notifications" id="notifications-menu" data-dropdown-panel="notifications"
              role="menu" aria-label="Notifications">
              <div class="dropdown-header">
                <span class="dropdown-title">Notifications</span>
                <button class="dropdown-link dropdown-mark-all js-mark-notifications" type="button">
                  Mark all as read
                </button>
              </div>
              <ul class="dropdown-list">
                <li class="dropdown-notification" role="menuitem">
                  <div class="notification-dot" aria-hidden="true"></div>
                  <div class="notification-body">
                    <p class="notification-title">Recurring donation processed</p>
                    <p class="notification-meta">2h &bull; Finance</p>
                  </div>
                  <span class="notification-time">2h</span>
                </li>
              </ul>
              <div class="dropdown-footer">
                <button type="button" class="dropdown-link">View all notifications</button>
              </div>
            </div>
          </div>

          <div class="dropdown-group dropdown-user">
            <button class="header-user js-dropdown-toggle js-user-menu-toggle" id="user-menu-toggle"
              data-dropdown-target="user-menu" type="button" aria-haspopup="true" aria-expanded="false"
              aria-controls="user-menu">
              <div class="avatar" aria-hidden="true">JL</div>
              <div class="user-details">
                <div class="user-name">Jordan Lee</div>
                <div class="user-email text-muted">jordan@donations.org</div>
              </div>
            </button>

            <div class="dropdown dropdown-user-menu" id="user-menu" data-dropdown-panel="user-menu" role="menu"
              aria-label="User menu">
              <div class="dropdown-user-info">
                <strong>Jordan Lee</strong>
                <span class="text-muted">jordan@donations.org</span>
              </div>
              <ul class="dropdown-list">
                <li>
                  <button class="dropdown-link" type="button">
                    <i class="fa fa-user" aria-hidden="true"></i>
                    Profile
                  </button>
                </li>
                <li>
                  <button class="dropdown-link" type="button">
                    <i class="fa fa-sign-out-alt" aria-hidden="true"></i>
                    Sign out
                  </button>
                </li>
              </ul>
            </div>
          </div>

        </div>
      </header>

      <!-- Main -->
      <main class="app-content" id="main-content" tabindex="-1" data-page="categories">
        <section class="page-header">
          <div>
            <nav class="page-header__breadcrumb" aria-label="Breadcrumb">
              <ol>
                <li><a href="index.html">Dashboard</a></li>
                <li aria-current="page">Categories</li>
              </ol>
            </nav>
            <div class="page-header__title">
              <h1 class="h3">Categories</h1>
              <p class="page-header__subtitle">Organize categories and sub-categories that structure each campaign.</p>
            </div>
          </div>
        </section>

        <section class="settings-page">
          <div class="categories-shell">
            <div class="settings-content">
              <div class="settings-panel settings-panel--active" data-settings-panel="categories" id="panel-categories"
                role="region" aria-label="Categories">
                <div class="settings-panel__header">
                  <div>
                    <h3>Categories</h3>
                    <p class="settings-panel__desc">Organize categories and sub-categories that structure each campaign.
                    </p>
                  </div>
                </div>

                <div class="settings-panel__body settings-categories">
                  <div class="settings-categories__pane">
                    <div class="settings-categories__header">
                      <h4>Categories</h4>
                      <button type="button" class="btn btn-outline" data-modal-open="category-form">Add
                        category</button>
                    </div>
                    <ul class="settings-categories__list" data-category-list></ul>
                  </div>

                  <div class="settings-categories__pane">
                    <div class="settings-categories__header">
                      <h4>Sub-categories</h4>
                      <button type="button" class="btn btn-outline" data-modal-open="subcategory-form">Add
                        sub-category</button>
                    </div>
                    <ul class="settings-categories__sublist" data-subcategory-list></ul>
                  </div>
                </div>

                <div class="settings-panel__actions">
                  <a class="btn btn-outline" href="settings.html">Back to settings</a>
                  <button type="button" class="btn btn-primary" data-save-button disabled>Save changes</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- لازم نفس المودالات بتوع التاب بالظبط -->
        <div class="modal" data-modal="category-form" hidden>
          <div class="modal__overlay" data-modal-close></div>
          <div class="modal__dialog" role="document" aria-modal="true" aria-labelledby="modal-category-title">
            <header class="modal__header">
              <h4 id="modal-category-title">Add category</h4>
              <button type="button" class="modal__close" data-modal-close aria-label="Close modal">
                <i class="fa-solid fa-xmark" aria-hidden="true"></i>
              </button>
            </header>
            <form id="category-form" class="modal__body" novalidate>
              <input type="hidden" name="categoryId" />
              <div class="form-field">
                <label class="form-label" for="category-name">Category name</label>
                <input id="category-name" class="form-control" type="text" name="name" required />
              </div>
              <div class="form-field">
                <label class="form-label" for="category-description">Description <span
                    class="text-muted">(optional)</span></label>
                <textarea id="category-description" class="form-control" name="description" rows="3"></textarea>
              </div>
              <div class="modal__actions">
                <button type="button" class="btn btn-outline" data-modal-close>Cancel</button>
                <button type="submit" class="btn btn-primary">Save category</button>
              </div>
            </form>
          </div>
        </div>

        <div class="modal" data-modal="subcategory-form" hidden>
          <div class="modal__overlay" data-modal-close></div>
          <div class="modal__dialog" role="document" aria-modal="true" aria-labelledby="modal-subcategory-title">
            <header class="modal__header">
              <h4 id="modal-subcategory-title">Add sub-category</h4>
              <button type="button" class="modal__close" data-modal-close aria-label="Close modal">
                <i class="fa-solid fa-xmark" aria-hidden="true"></i>
              </button>
            </header>
            <form id="subcategory-form" class="modal__body" novalidate>
              <input type="hidden" name="subcategoryId" />
              <input type="hidden" name="categoryId" />
              <div class="form-field">
                <label class="form-label" for="subcategory-name">Sub-category name</label>
                <input id="subcategory-name" class="form-control" type="text" name="name" required />
              </div>
              <div class="modal__actions">
                <button type="button" class="btn btn-outline" data-modal-close>Cancel</button>
                <button type="submit" class="btn btn-primary">Save sub-category</button>
              </div>
            </form>
          </div>
        </div>

        <div class="toast-container" aria-live="polite" aria-atomic="true"></div>
      </main>

      <footer class="app-footer">
        <p class="text-muted">&copy; 2025 Donations Dashboard. All rights reserved.</p>
      </footer>
    </div>
  </div>

  <script src="assets/js/jquery-3.7.1.min.js" defer></script>
  <script src="assets/js/owl.carousel.min.js" defer></script>
  <script src="assets/js/bootstrap.bundle.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts" defer></script>
  <script src="assets/js/script.js" defer></script>

  <script>
    (function () {
      // Toast helper (نفس الفكرة اللي عندك)
      function showToast(msg) {
        const container = document.querySelector('.toast-container');
        if (!container) return;
        const t = document.createElement('div');
        t.className = 'toast';
        t.textContent = msg;
        t.style.padding = '10px 14px';
        t.style.marginTop = '8px';
        t.style.background = 'var(--color-surface)';
        t.style.border = '1px solid var(--color-border)';
        t.style.borderRadius = '10px';
        container.appendChild(t);
        setTimeout(() => {
          t.style.opacity = 0;
          t.style.transition = 'opacity 300ms';
          setTimeout(() => t.remove(), 350);
        }, 2500);
      }

      function enableSave() {
        const btn = document.querySelector('[data-save-button]');
        if (btn) btn.removeAttribute('disabled');
      }

      // Modal open/close (compatible with your data attrs)
      function openModal(modal) { if (!modal) return; modal.hidden = false; }
      function closeModal(modal) { if (!modal) return; modal.hidden = true; }

      document.addEventListener('click', (e) => {
        const opener = e.target.closest('[data-modal-open]');
        if (opener) {
          const key = opener.getAttribute('data-modal-open');
          openModal(document.querySelector('[data-modal="' + key + '"]'));
        }

        const closer = e.target.closest('[data-modal-close]');
        if (closer) {
          closeModal(closer.closest('.modal'));
        }
      });

      // Demo data (عشان اللستات متبقاش فاضية)
      const categories = [
        { id: 'cat-1', name: 'Education', desc: 'Schools, supplies, scholarships' },
        { id: 'cat-2', name: 'Healthcare', desc: 'Medical aid and emergency response' },
        { id: 'cat-3', name: 'Food', desc: 'Meals, parcels, nutrition' }
      ];

      const subcategories = [
        { id: 'sub-1', categoryId: 'cat-1', name: 'Back to school kits' },
        { id: 'sub-2', categoryId: 'cat-1', name: 'Teacher support' },
        { id: 'sub-3', categoryId: 'cat-2', name: 'Clinic supplies' },
        { id: 'sub-4', categoryId: 'cat-3', name: 'Hot meals' }
      ];

      const catList = document.querySelector('[data-category-list]');
      const subList = document.querySelector('[data-subcategory-list]');

      function render() {
        if (catList) {
          catList.innerHTML = categories.map(c => `
            <li class="settings-categories__item" data-category-id="${c.id}">
              <div class="settings-categories__item-main">
                <strong>${c.name}</strong>
                <p class="text-muted">${c.desc || ''}</p>
              </div>
              <div class="settings-categories__item-actions">
                <button type="button" class="btn btn-ghost btn-sm" data-action="edit-category">
                  <i class="fa-regular fa-pen-to-square"></i>
                </button>
                <button type="button" class="btn btn-ghost btn-ghost--danger btn-sm" data-action="delete-category">
                  <i class="fa-regular fa-trash-can"></i>
                </button>
              </div>
            </li>
          `).join('');
        }

        if (subList) {
          subList.innerHTML = subcategories.map(s => {
            const parent = categories.find(c => c.id === s.categoryId);
            return `
              <li class="settings-categories__item" data-subcategory-id="${s.id}" data-category-id="${s.categoryId}">
                <div class="settings-categories__item-main">
                  <strong>${s.name}</strong>
                  <p class="text-muted">Category: ${parent ? parent.name : '—'}</p>
                </div>
                <div class="settings-categories__item-actions">
                  <button type="button" class="btn btn-ghost btn-sm" data-action="edit-subcategory">
                    <i class="fa-regular fa-pen-to-square"></i>
                  </button>
                  <button type="button" class="btn btn-ghost btn-ghost--danger btn-sm" data-action="delete-subcategory">
                    <i class="fa-regular fa-trash-can"></i>
                  </button>
                </div>
              </li>
            `;
          }).join('');
        }
      }

      render();

      // Enable save on any interaction
      document.addEventListener('input', (e) => {
        if (e.target.closest('#category-form, #subcategory-form')) enableSave();
      });
      document.addEventListener('change', (e) => {
        if (e.target.closest('#category-form, #subcategory-form')) enableSave();
      });

      // Handle form submit (demo only)
      const catForm = document.getElementById('category-form');
      const subForm = document.getElementById('subcategory-form');

      if (catForm) {
        catForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const id = catForm.elements.categoryId.value || ('cat-' + Date.now());
          const name = catForm.elements.name.value.trim();
          const desc = catForm.elements.description.value.trim();

          if (!name) return;

          const existing = categories.find(c => c.id === id);
          if (existing) {
            existing.name = name; existing.desc = desc;
            showToast('Category updated (demo)');
          } else {
            categories.unshift({ id, name, desc });
            showToast('Category added (demo)');
          }

          render();
          closeModal(document.querySelector('[data-modal="category-form"]'));
          catForm.reset();
          catForm.elements.categoryId.value = '';
          enableSave();
        });
      }

      if (subForm) {
        subForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const id = subForm.elements.subcategoryId.value || ('sub-' + Date.now());
          const name = subForm.elements.name.value.trim();
          const categoryId = subForm.elements.categoryId.value || (categories[0] ? categories[0].id : '');

          if (!name) return;

          const existing = subcategories.find(s => s.id === id);
          if (existing) {
            existing.name = name;
            existing.categoryId = categoryId;
            showToast('Sub-category updated (demo)');
          } else {
            subcategories.unshift({ id, name, categoryId });
            showToast('Sub-category added (demo)');
          }

          render();
          closeModal(document.querySelector('[data-modal="subcategory-form"]'));
          subForm.reset();
          subForm.elements.subcategoryId.value = '';
          subForm.elements.categoryId.value = '';
          enableSave();
        });
      }

      // Edit/Delete actions (demo only)
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('[data-action]');
        if (!btn) return;

        const action = btn.getAttribute('data-action');
        const li = btn.closest('li');

        if (action === 'edit-category' && li) {
          const id = li.getAttribute('data-category-id');
          const item = categories.find(c => c.id === id);
          if (!item) return;

          const modal = document.querySelector('[data-modal="category-form"]');
          document.querySelector('#modal-category-title').textContent = 'Edit category';
          catForm.elements.categoryId.value = item.id;
          catForm.elements.name.value = item.name;
          catForm.elements.description.value = item.desc || '';
          openModal(modal);
        }

        if (action === 'delete-category' && li) {
          const id = li.getAttribute('data-category-id');
          const idx = categories.findIndex(c => c.id === id);
          if (idx >= 0) categories.splice(idx, 1);

          // delete related subs (demo)
          for (let i = subcategories.length - 1; i >= 0; i--) {
            if (subcategories[i].categoryId === id) subcategories.splice(i, 1);
          }

          render();
          showToast('Category deleted (demo)');
          enableSave();
        }

        if (action === 'edit-subcategory' && li) {
          const id = li.getAttribute('data-subcategory-id');
          const item = subcategories.find(s => s.id === id);
          if (!item) return;

          const modal = document.querySelector('[data-modal="subcategory-form"]');
          document.querySelector('#modal-subcategory-title').textContent = 'Edit sub-category';
          subForm.elements.subcategoryId.value = item.id;
          subForm.elements.categoryId.value = item.categoryId || '';
          subForm.elements.name.value = item.name;
          openModal(modal);
        }

        if (action === 'delete-subcategory' && li) {
          const id = li.getAttribute('data-subcategory-id');
          const idx = subcategories.findIndex(s => s.id === id);
          if (idx >= 0) subcategories.splice(idx, 1);
          render();
          showToast('Sub-category deleted (demo)');
          enableSave();
        }
      });

      // Save changes (demo)
      const saveBtn = document.querySelector('[data-save-button]');
      if (saveBtn) {
        saveBtn.addEventListener('click', () => {
          showToast('Categories saved (demo)');
          saveBtn.setAttribute('disabled', '');
        });
      }
    })();
  </script>
</body>

</html>